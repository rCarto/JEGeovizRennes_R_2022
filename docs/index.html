<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Timothée Giraud">

<title>Faire des cartes avec le logiciel libre R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table des matières</h2>
   
  <ul>
  <li><a href="#présentation-de-loutil-et-de-son-environnement" id="toc-présentation-de-loutil-et-de-son-environnement" class="nav-link active" data-scroll-target="#présentation-de-loutil-et-de-son-environnement"><span class="toc-section-number">1</span>  Présentation de l’outil et de son environnement</a>
  <ul class="collapse">
  <li><a href="#r-et-rstudio" id="toc-r-et-rstudio" class="nav-link" data-scroll-target="#r-et-rstudio"><span class="toc-section-number">1.1</span>  R et RStudio</a></li>
  <li><a href="#lécosystème-spatial-de-r" id="toc-lécosystème-spatial-de-r" class="nav-link" data-scroll-target="#lécosystème-spatial-de-r"><span class="toc-section-number">1.2</span>  L’Écosystème spatial de R</a></li>
  </ul></li>
  <li><a href="#exemple-danalyse" id="toc-exemple-danalyse" class="nav-link" data-scroll-target="#exemple-danalyse"><span class="toc-section-number">2</span>  Exemple d’analyse</a>
  <ul class="collapse">
  <li><a href="#préparation-des-données" id="toc-préparation-des-données" class="nav-link" data-scroll-target="#préparation-des-données"><span class="toc-section-number">2.1</span>  Préparation des données</a>
  <ul class="collapse">
  <li><a href="#téléchargement-des-données" id="toc-téléchargement-des-données" class="nav-link" data-scroll-target="#téléchargement-des-données"><span class="toc-section-number">2.1.1</span>  Téléchargement des données</a></li>
  <li><a href="#import-des-données" id="toc-import-des-données" class="nav-link" data-scroll-target="#import-des-données"><span class="toc-section-number">2.1.2</span>  Import des données</a></li>
  <li><a href="#découverte-du-jeu-de-données" id="toc-découverte-du-jeu-de-données" class="nav-link" data-scroll-target="#découverte-du-jeu-de-données"><span class="toc-section-number">2.1.3</span>  Découverte du jeu de données</a></li>
  <li><a href="#nettoyage" id="toc-nettoyage" class="nav-link" data-scroll-target="#nettoyage"><span class="toc-section-number">2.1.4</span>  Nettoyage</a></li>
  </ul></li>
  <li><a href="#analyse-globale" id="toc-analyse-globale" class="nav-link" data-scroll-target="#analyse-globale"><span class="toc-section-number">2.2</span>  Analyse globale</a>
  <ul class="collapse">
  <li><a href="#calcul-des-indicateurs-gestion-des-unités-de-mesure" id="toc-calcul-des-indicateurs-gestion-des-unités-de-mesure" class="nav-link" data-scroll-target="#calcul-des-indicateurs-gestion-des-unités-de-mesure"><span class="toc-section-number">2.2.1</span>  Calcul des indicateurs, gestion des unités de mesure</a></li>
  <li><a href="#représentations" id="toc-représentations" class="nav-link" data-scroll-target="#représentations"><span class="toc-section-number">2.2.2</span>  Représentations</a></li>
  </ul></li>
  <li><a href="#zoom-sur-la-haute-garonne" id="toc-zoom-sur-la-haute-garonne" class="nav-link" data-scroll-target="#zoom-sur-la-haute-garonne"><span class="toc-section-number">2.3</span>  Zoom sur la Haute-Garonne</a>
  <ul class="collapse">
  <li><a href="#sélection-des-données" id="toc-sélection-des-données" class="nav-link" data-scroll-target="#sélection-des-données"><span class="toc-section-number">2.3.1</span>  Sélection des données</a></li>
  <li><a href="#calcul-des-indicateurs-gestion-des-unités-de-mesure-1" id="toc-calcul-des-indicateurs-gestion-des-unités-de-mesure-1" class="nav-link" data-scroll-target="#calcul-des-indicateurs-gestion-des-unités-de-mesure-1"><span class="toc-section-number">2.3.2</span>  Calcul des indicateurs, gestion des unités de mesure</a></li>
  <li><a href="#représentations-et-statistiques" id="toc-représentations-et-statistiques" class="nav-link" data-scroll-target="#représentations-et-statistiques"><span class="toc-section-number">2.3.3</span>  Représentations et statistiques</a></li>
  <li><a href="#récupération-de-trajets-théoriques" id="toc-récupération-de-trajets-théoriques" class="nav-link" data-scroll-target="#récupération-de-trajets-théoriques"><span class="toc-section-number">2.3.4</span>  Récupération de trajets théoriques</a></li>
  <li><a href="#import-des-trajets-pré-enregistrés" id="toc-import-des-trajets-pré-enregistrés" class="nav-link" data-scroll-target="#import-des-trajets-pré-enregistrés"><span class="toc-section-number">2.3.5</span>  (Import des trajets pré-enregistrés)</a></li>
  <li><a href="#comparaison-des-trajets-réels-et-théoriques" id="toc-comparaison-des-trajets-réels-et-théoriques" class="nav-link" data-scroll-target="#comparaison-des-trajets-réels-et-théoriques"><span class="toc-section-number">2.3.6</span>  Comparaison des trajets réels et théoriques</a></li>
  <li><a href="#cartographie-1" id="toc-cartographie-1" class="nav-link" data-scroll-target="#cartographie-1"><span class="toc-section-number">2.3.7</span>  Cartographie 1</a></li>
  <li><a href="#cartographie-2" id="toc-cartographie-2" class="nav-link" data-scroll-target="#cartographie-2"><span class="toc-section-number">2.3.8</span>  Cartographie 2</a></li>
  <li><a href="#cartographie-3" id="toc-cartographie-3" class="nav-link" data-scroll-target="#cartographie-3"><span class="toc-section-number">2.3.9</span>  Cartographie 3</a></li>
  <li><a href="#cartographie-4" id="toc-cartographie-4" class="nav-link" data-scroll-target="#cartographie-4"><span class="toc-section-number">2.3.10</span>  Cartographie 4</a></li>
  </ul></li>
  <li><a href="#autres-villes" id="toc-autres-villes" class="nav-link" data-scroll-target="#autres-villes"><span class="toc-section-number">2.4</span>  Autres villes</a></li>
  <li><a href="#pour-la-reproductibilité" id="toc-pour-la-reproductibilité" class="nav-link" data-scroll-target="#pour-la-reproductibilité"><span class="toc-section-number">2.5</span>  Pour la reproductibilité</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Faire des cartes avec le logiciel libre R</h1>
<p class="subtitle lead">Journée d’étude - La boîte à outils de cartographie et de géovisualisation de données : regards croisés de chercheurs</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Auteur·rice</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    Timothée Giraud <a href="https://orcid.org/0000-0002-1932-3323" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://riate.cnrs.fr">
            RIATE (CNRS)
            </a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Date de publication</div>
    <div class="quarto-title-meta-contents">
      <p class="date">6 janvier 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="présentation-de-loutil-et-de-son-environnement" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Présentation de l’outil et de son environnement</h1>
<section id="r-et-rstudio" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="r-et-rstudio"><span class="header-section-number">1.1</span> R et RStudio</h2>
<p><a href="https://rcarto.github.io/R_et_RStudio/index.html">Diaporama</a></p>
</section>
<section id="lécosystème-spatial-de-r" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="lécosystème-spatial-de-r"><span class="header-section-number">1.2</span> L’Écosystème spatial de R</h2>
<p><a href="https://elementr.gitpages.huma-num.fr/session_1/rspatial/">Diaporama</a></p>
</section>
</section>
<section id="exemple-danalyse" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Exemple d’analyse</h1>
<p>Nous voulons étudier les déplacements effectués en covoiturage. Nous nous concentrerons sur les durées, distances et vitesses de ces déplacements.</p>
<section id="préparation-des-données" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="préparation-des-données"><span class="header-section-number">2.1</span> Préparation des données</h2>
<section id="téléchargement-des-données" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="téléchargement-des-données"><span class="header-section-number">2.1.1</span> Téléchargement des données</h3>
<p>Nous téléchargeons les données pour les mois de septembre, octobre et novembre 2022.</p>
<div class="cell" data-hash="index_cache/html/download_92d00e0a9eb4e68cef5cd4e671a3f50f">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creation d'un dossier</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"data-raw"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># URLs des fichiers</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>cov_2022_11 <span class="ot">&lt;-</span> <span class="st">"https://www.data.gouv.fr/fr/datasets/r/5d469743-9636-4e84-841c-2ae1111b4009"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>cov_2022_10 <span class="ot">&lt;-</span> <span class="st">"https://www.data.gouv.fr/fr/datasets/r/80b38046-8166-49fd-bbee-fc0ba9612a88"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>cov_2022_09 <span class="ot">&lt;-</span> <span class="st">"https://www.data.gouv.fr/fr/datasets/r/513862ee-8e8e-426b-9b67-7a4e39ab253a"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># téléchargement des fichiers</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(cov_2022_11, <span class="at">destfile =</span> <span class="st">"data-raw/cov_2022_11.csv"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(cov_2022_10, <span class="at">destfile =</span> <span class="st">"data-raw/cov_2022_10.csv"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(cov_2022_09, <span class="at">destfile =</span> <span class="st">"data-raw/cov_2022_09.csv"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-des-données" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="import-des-données"><span class="header-section-number">2.1.2</span> Import des données</h3>
<p>Une fois les données téléchargées nous pouvons les importer dans R.</p>
<div class="cell" data-hash="index_cache/html/import_1280e8e83a1df5265b8fc9f83b97baa1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import des fichiers dans R</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>cov_raw_1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">"data-raw/cov_2022_09.csv"</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>cov_raw_2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">"data-raw/cov_2022_10.csv"</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>cov_raw_3 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">"data-raw/cov_2022_11.csv"</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rassemblement des 3 tables</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>cov_raw <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cov_raw_1, cov_raw_2, cov_raw_3)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="découverte-du-jeu-de-données" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="découverte-du-jeu-de-données"><span class="header-section-number">2.1.3</span> Découverte du jeu de données</h3>
<p>Nous pouvons étudier la structure et quelques statistiques très basiques sur le jeu de données.</p>
<div class="cell" data-hash="index_cache/html/decouverte1_8217792c0279c0f021c02b87c8428767">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># structure du jeu de données</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cov_raw)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1789222 obs. of  27 variables:
 $ journey_id              : int  8481314 8539389 8481290 8481291 8481285 8497884 8481249 8481319 8485451 8481238 ...
 $ trip_id                 : chr  "c63637d5-e8d4-4772-a350-9682191f73ef" "9bbc99b5-ebf4-4cf5-b669-854b8187a35c" "e4525811-0fae-49a5-be8b-1e5dbe7906ab" "e4525811-0fae-49a5-be8b-1e5dbe7906ab" ...
 $ journey_start_datetime  : chr  "2022-09-01T00:00:00+02:00" "2022-09-01T00:00:00+02:00" "2022-09-01T00:00:00+02:00" "2022-09-01T00:00:00+02:00" ...
 $ journey_start_date      : chr  "2022-09-01" "2022-09-01" "2022-09-01" "2022-09-01" ...
 $ journey_start_time      : chr  "00:00:00" "00:00:00" "00:00:00" "00:00:00" ...
 $ journey_start_lon       : num  1.07 2.77 3.14 3.14 2.38 ...
 $ journey_start_lat       : num  49.4 48.9 48.9 48.9 48.8 ...
 $ journey_start_insee     : int  76540 77111 77183 77183 75056 75056 34154 76540 34344 49007 ...
 $ journey_start_department: int  76 77 77 77 75 75 34 76 34 49 ...
 $ journey_start_town      : chr  "Rouen" "Chessy" "La Ferté-sous-Jouarre" "La Ferté-sous-Jouarre" ...
 $ journey_start_towngroup : chr  "Métropole Rouen Normandie" "CA Val d'Europe Agglomération" "CA Coulommiers Pays de Brie" "CA Coulommiers Pays de Brie" ...
 $ journey_start_country   : chr  "France" "France" "France" "France" ...
 $ journey_end_datetime    : chr  "2022-09-01T00:40:00+02:00" "2022-09-01T00:10:00+02:00" "2022-09-01T00:50:00+02:00" "2022-09-01T00:50:00+02:00" ...
 $ journey_end_date        : chr  "2022-09-01" "2022-09-01" "2022-09-01" "2022-09-01" ...
 $ journey_end_time        : chr  "00:40:00" "00:10:00" "00:50:00" "00:50:00" ...
 $ journey_end_lon         : num  0.966 2.667 2.674 2.674 1.963 ...
 $ journey_end_lat         : num  49.3 48.9 48.9 48.9 48.8 ...
 $ journey_end_insee       : int  27638 77438 77517 77517 78208 91345 34090 27638 34172 49007 ...
 $ journey_end_department  : int  27 77 77 77 78 91 34 27 34 49 ...
 $ journey_end_town        : chr  "Le Thuit de l'Oison" "Saint-Thibault-des-Vignes" "Villevaudé" "Villevaudé" ...
 $ journey_end_towngroup   : chr  "CC Roumois Seine" "CA Marne et Gondoire" "CC Plaines et Monts de France" "CC Plaines et Monts de France" ...
 $ journey_end_country     : chr  "France" "France" "France" "France" ...
 $ passenger_seats         : int  1 1 1 1 1 1 1 1 1 1 ...
 $ operator_class          : chr  "C" "C" "C" "C" ...
 $ journey_distance        : int  25476 10780 49803 49803 39093 19941 8144 28086 29696 2525 ...
 $ journey_duration        : int  40 12 47 47 47 33 18 41 51 10 ...
 $ has_incentive           : chr  "OUI" "OUI" "OUI" "OUI" ...</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/decouverte2_1955f0c781c842e2cc8df613c23e8823">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># statistiques basiques</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cov_raw)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   journey_id         trip_id          journey_start_datetime
 Min.   : 8481238   Length:1789222     Length:1789222        
 1st Qu.: 8988565   Class :character   Class :character      
 Median : 9740834   Mode  :character   Mode  :character      
 Mean   : 9672942                                            
 3rd Qu.:10322829                                            
 Max.   :10854769                                            
                                                             
 journey_start_date journey_start_time journey_start_lon journey_start_lat
 Length:1789222     Length:1789222     Min.   :-61.723   Min.   :-21.38   
 Class :character   Class :character   1st Qu.:  1.068   1st Qu.: 46.52   
 Mode  :character   Mode  :character   Median :  2.270   Median : 48.65   
                                       Mean   :  2.854   Mean   : 46.87   
                                       3rd Qu.:  3.510   3rd Qu.: 48.96   
                                       Max.   : 55.825   Max.   : 51.95   
                                                                          
 journey_start_insee journey_start_department journey_start_town
 Min.   : 1004       Min.   :  1.00           Length:1789222    
 1st Qu.:44109       1st Qu.: 44.00           Class :character  
 Median :76020       Median : 75.00           Mode  :character  
 Mean   :64655       Mean   : 74.17                             
 3rd Qu.:88327       3rd Qu.: 85.00                             
 Max.   :99140       Max.   :974.00                             
                     NA's   :41702                              
 journey_start_towngroup journey_start_country journey_end_datetime
 Length:1789222          Length:1789222        Length:1789222      
 Class :character        Class :character      Class :character    
 Mode  :character        Mode  :character      Mode  :character    
                                                                   
                                                                   
                                                                   
                                                                   
 journey_end_date   journey_end_time   journey_end_lon   journey_end_lat 
 Length:1789222     Length:1789222     Min.   :-61.567   Min.   :-21.39  
 Class :character   Class :character   1st Qu.:  1.069   1st Qu.: 46.53  
 Mode  :character   Mode  :character   Median :  2.269   Median : 48.65  
                                       Mean   :  2.854   Mean   : 46.87  
                                       3rd Qu.:  3.510   3rd Qu.: 48.96  
                                       Max.   : 55.826   Max.   : 51.99  
                                                                         
 journey_end_insee journey_end_department journey_end_town  
 Min.   : 1004     Min.   :  1.00         Length:1789222    
 1st Qu.:44109     1st Qu.: 44.00         Class :character  
 Median :76057     Median : 75.00         Mode  :character  
 Mean   :64794     Mean   : 74.27                           
 3rd Qu.:89206     3rd Qu.: 85.00                           
 Max.   :99140     Max.   :974.00                           
                   NA's   :44592                            
 journey_end_towngroup journey_end_country passenger_seats operator_class    
 Length:1789222        Length:1789222      Min.   :1       Length:1789222    
 Class :character      Class :character    1st Qu.:1       Class :character  
 Mode  :character      Mode  :character    Median :1       Mode  :character  
                                           Mean   :1                         
                                           3rd Qu.:1                         
                                           Max.   :4                         
                                                                             
 journey_distance  journey_duration has_incentive     
 Min.   :      0   Min.   :  0.00   Length:1789222    
 1st Qu.:  10066   1st Qu.: 17.00   Class :character  
 Median :  20245   Median : 26.00   Mode  :character  
 Mean   :  24848   Mean   : 29.44                     
 3rd Qu.:  33140   3rd Qu.: 38.00                     
 Max.   :1038359   Max.   :716.00                     
                                                      </code></pre>
</div>
</div>
<p>Intéressons nous plus particulièrement aux distances et durées des trajets.</p>
<div class="cell" data-hash="index_cache/html/decouverte3_6ad596b13132a9ae43195800f326bbeb">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cov_raw<span class="sc">$</span>journey_distance)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      0   10066   20245   24848   33140 1038359 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cov_raw<span class="sc">$</span>journey_duration)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00   17.00   26.00   29.44   38.00  716.00 </code></pre>
</div>
</div>
<p>Les valeurs minimums de ces variables sont à 0, ce n’est pas très réaliste.</p>
</section>
<section id="nettoyage" class="level3" data-number="2.1.4">
<h3 data-number="2.1.4" class="anchored" data-anchor-id="nettoyage"><span class="header-section-number">2.1.4</span> Nettoyage</h3>
<p>Suppression des trajets dont la durée est inférieure à 2 minutes ou la distance inférieure à 1 kilomètre.</p>
<div class="cell" data-hash="index_cache/html/clean_8a43c3eaf49cc07b5eab9ca9c3b20f48">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cov <span class="ot">&lt;-</span> cov_raw[cov_raw<span class="sc">$</span>journey_distance <span class="sc">&gt;=</span> <span class="dv">1000</span> <span class="sc">&amp;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                 cov_raw<span class="sc">$</span>journey_duration <span class="sc">&gt;=</span> <span class="dv">2</span>, ]</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="analyse-globale" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="analyse-globale"><span class="header-section-number">2.2</span> Analyse globale</h2>
<section id="calcul-des-indicateurs-gestion-des-unités-de-mesure" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="calcul-des-indicateurs-gestion-des-unités-de-mesure"><span class="header-section-number">2.2.1</span> Calcul des indicateurs, gestion des unités de mesure</h3>
<p>Le package <code>units</code> <span class="citation" data-cites="R-units">(<a href="#ref-R-units" role="doc-biblioref">Pebesma et al., 2016</a>)</span> permet de définir et convertir facilement les unités de mesure.</p>
<div class="cell" data-hash="index_cache/html/indicators_aa40dd82a12f5e7a17cfd83817253ca8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extraction des variable dans des vecteurs distincts</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>duree <span class="ot">&lt;-</span> cov<span class="sc">$</span>journey_duration</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">&lt;-</span> cov<span class="sc">$</span>journey_distance</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(units)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>udunits database from /usr/share/xml/udunits/udunits2.xml</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># définition des unités de mesure initiales</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">units</span>(distance) <span class="ot">&lt;-</span> <span class="st">"m"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">units</span>(duree) <span class="ot">&lt;-</span> <span class="st">"min"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># transformation des unités de mesure</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">&lt;-</span> <span class="fu">set_units</span>(distance, <span class="st">"km"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>duree <span class="ot">&lt;-</span> <span class="fu">set_units</span>(duree, <span class="st">"h"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># creation d'un vecteur des distances</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>vitesse <span class="ot">&lt;-</span> distance <span class="sc">/</span> duree</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="représentations" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="représentations"><span class="header-section-number">2.2.2</span> Représentations</h3>
<p>Nous pouvons calculer quelques statistiques sur nos indicateurs.</p>
<div class="cell" data-hash="index_cache/html/table_2f44fa2733c49aef22d0bfdd90b5fe11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">summary</span>(duree), </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summary</span>(distance), </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summary</span>(vitesse)), </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="fu">c</span>(<span class="st">"Durée (h)"</span>, <span class="st">"Distance (km)"</span>, <span class="st">"Vitesse (km/h)"</span>), </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names =</span> <span class="cn">FALSE</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(summary_table, <span class="at">digits =</span> <span class="dv">1</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Min.</th>
<th style="text-align: right;">1st Qu.</th>
<th style="text-align: right;">Median</th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">3rd Qu.</th>
<th style="text-align: right;">Max.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Durée (h)</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.6</td>
<td style="text-align: right;">11.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distance (km)</td>
<td style="text-align: right;">1.2</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: right;">20.2</td>
<td style="text-align: right;">24.9</td>
<td style="text-align: right;">33.1</td>
<td style="text-align: right;">1038.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vitesse (km/h)</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">33.2</td>
<td style="text-align: right;">44.5</td>
<td style="text-align: right;">46.6</td>
<td style="text-align: right;">58.2</td>
<td style="text-align: right;">184.4</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Nous pouvons aussi créer rapidement des histogrammes des distributions.</p>
<div class="cell" data-hash="index_cache/html/histograms_4b0d18bf116ccb934af608fc3fd11990">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(duree)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(distance)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(vitesse)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/histograms-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/histograms-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/histograms-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Et finalement nous pouvons croiser les variables deux à deux avec des nuages de points.</p>
<div class="cell" data-hash="index_cache/html/plot_dd_486d51ac10767fbe0f3a04020a45c220">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> distance, <span class="at">y =</span> duree,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Rapport entre durée et distance des trajets"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">4</span>, <span class="at">col =</span> <span class="st">"white"</span>, <span class="at">bg =</span> <span class="st">"darkred"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_dd-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="index_cache/html/plot_dv_140dd01a1446d3ca7ce026ad0e03f9a5">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> distance, <span class="at">y =</span> vitesse,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Rapport entre vitesse et distance des trajets"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">4</span>, <span class="at">col =</span> <span class="st">"white"</span>, <span class="at">bg =</span> <span class="st">"darkblue"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">80</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> .<span class="dv">5</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">110</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> .<span class="dv">5</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_dv-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">

</div>
</section>
</section>
<section id="zoom-sur-la-haute-garonne" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="zoom-sur-la-haute-garonne"><span class="header-section-number">2.3</span> Zoom sur la Haute-Garonne</h2>
<section id="sélection-des-données" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="sélection-des-données"><span class="header-section-number">2.3.1</span> Sélection des données</h3>
<p>Nous sélectionnons les trajets depuis la Haute-Garonne (31) de moins de 100 km et de moins d’1h30.</p>
<div class="cell" data-hash="index_cache/html/selecta31_c7ad4ebbf9103ddbe3ecf042061c0730">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># choix du département</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dep <span class="ot">&lt;-</span> <span class="dv">31</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># selection</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>covdep <span class="ot">&lt;-</span> cov[cov<span class="sc">$</span>journey_start_department <span class="sc">%in%</span> dep <span class="sc">&amp;</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                cov<span class="sc">$</span>journey_distance <span class="sc">&lt;=</span> <span class="dv">100000</span> <span class="sc">&amp;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                cov<span class="sc">$</span>journey_duration <span class="sc">&lt;=</span> <span class="dv">150</span>, ]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dimension de l'extraction</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(covdep)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 28917    27</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Il suffit de modifier <code>dep &lt;- 31</code> pour obtenir l’analyse sur un autre département.</p>
</div>
</div>
</section>
<section id="calcul-des-indicateurs-gestion-des-unités-de-mesure-1" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="calcul-des-indicateurs-gestion-des-unités-de-mesure-1"><span class="header-section-number">2.3.2</span> Calcul des indicateurs, gestion des unités de mesure</h3>
<div class="cell" data-hash="index_cache/html/indicators31_7d8062dddb1fa6e2930ffca49e330c78">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extraction des variable dans des vecteurs</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>duree <span class="ot">&lt;-</span> covdep<span class="sc">$</span>journey_duration</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">&lt;-</span> covdep<span class="sc">$</span>journey_distance</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(units)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># définition des unités de mesure initiales</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">units</span>(distance) <span class="ot">&lt;-</span> <span class="st">"m"</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">units</span>(duree) <span class="ot">&lt;-</span> <span class="st">"min"</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># transformation d'unité de mesure</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">&lt;-</span> <span class="fu">set_units</span>(distance, <span class="st">"km"</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calcul des vitesses</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>vitesse <span class="ot">&lt;-</span> distance <span class="sc">/</span> duree</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co"># transformation de l'unité de mesure des vitesses</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>vitesse <span class="ot">&lt;-</span> <span class="fu">set_units</span>(vitesse, <span class="st">"km/h"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="représentations-et-statistiques" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="représentations-et-statistiques"><span class="header-section-number">2.3.3</span> Représentations et statistiques</h3>
<div class="cell" data-hash="index_cache/html/table31_190616a3bc756988a9c2b2f6fc6c4088">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">summary</span>(duree), </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summary</span>(distance), </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summary</span>(vitesse)), </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="fu">c</span>(<span class="st">"Durée (m)"</span>, <span class="st">"Distance (km)"</span>, <span class="st">"Vitesse (km/h)"</span>), </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names =</span> <span class="cn">FALSE</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(summary_table, <span class="at">digits =</span> <span class="dv">1</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Min.</th>
<th style="text-align: right;">1st Qu.</th>
<th style="text-align: right;">Median</th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">3rd Qu.</th>
<th style="text-align: right;">Max.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Durée (m)</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">16.0</td>
<td style="text-align: right;">22.0</td>
<td style="text-align: right;">24.3</td>
<td style="text-align: right;">30.0</td>
<td style="text-align: right;">86.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distance (km)</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: right;">9.8</td>
<td style="text-align: right;">15.8</td>
<td style="text-align: right;">22.3</td>
<td style="text-align: right;">27.2</td>
<td style="text-align: right;">95.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vitesse (km/h)</td>
<td style="text-align: right;">13.4</td>
<td style="text-align: right;">34.1</td>
<td style="text-align: right;">44.6</td>
<td style="text-align: right;">49.8</td>
<td style="text-align: right;">62.5</td>
<td style="text-align: right;">110.8</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="index_cache/html/histograms31_99955c2415cff8d374dfdb224988d97d">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(duree, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">max</span>(<span class="fu">as.numeric</span>(duree))<span class="sc">+</span><span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(distance, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">1</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(vitesse, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">max</span>(<span class="fu">as.numeric</span>(vitesse)<span class="sc">+</span><span class="dv">1</span>),<span class="dv">1</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/histograms31-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/histograms31-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/histograms31-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="index_cache/html/plot_dd31_e5b27defe5a72ae96aa24826500e3bd1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> distance, <span class="at">y =</span> duree,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Rapport entre durée et distance des trajets"</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">4</span>, <span class="at">col =</span> <span class="st">"white"</span>, <span class="at">bg =</span> <span class="st">"darkred"</span>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_dd31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="index_cache/html/plot_dv31_3f87be961f4731820334a690d7c93fbc">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> distance, <span class="at">y =</span> vitesse,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Rapport entre vitesse et distance des trajets"</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">4</span>, <span class="at">col =</span> <span class="st">"white"</span>, <span class="at">bg =</span> <span class="st">"darkblue"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot_dv31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="récupération-de-trajets-théoriques" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="récupération-de-trajets-théoriques"><span class="header-section-number">2.3.4</span> Récupération de trajets théoriques</h3>
<p>Dans la partie suivante nous voulons obtenir une approximation des trajets effectués par les usagers du covoiturage. Pour cela nous utiliserons les trajets par le plus court chemin entre les départs et les arrivées des covoiturages en utilisant le réseau routier fourni par la base de données OpenStreetMap.</p>
<p>Nous utilisons le package <code>osrm</code> <span class="citation" data-cites="R-osrm">(<a href="#ref-R-osrm" role="doc-biblioref">Giraud, 2022c</a>)</span> pour récupérer ces trajets théoriques. Ces trajets sont calculés par le logiciel OSRM (Open Source Routing Machine) <span class="citation" data-cites="luxen-vetter-2011">(<a href="#ref-luxen-vetter-2011" role="doc-biblioref">Luxen et Vetter, 2011</a>)</span> qui se base sur les données d’OpenStreetMap. Le package <code>osrm</code> sert d’interface entre R et OSRM.</p>
<p>La fonction ci-dessous est utile pour demander une très grande quantité de routes en utilisant les fonctionnalités de parallélisation de R. Pour l’utiliser il est nécessaire d’avoir accès à un serveur OSRM.</p>
<div class="cell" data-hash="index_cache/html/nadapar_eb66f9fa30e785477c29a2549e5e6441">
<details>
<summary>Fonction d’extraction des routes en masse</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>get_routes <span class="ot">&lt;-</span> <span class="cf">function</span>(x, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">srcX =</span> <span class="st">"srcx"</span>, <span class="at">srcY =</span> <span class="st">"srcy"</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">dstX =</span> <span class="st">"dstx"</span>, <span class="at">dstY =</span> <span class="st">"dsty"</span>, </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ncl =</span> <span class="dv">5</span>){</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  ny <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  sequence <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, ny, <span class="dv">500</span>), ny <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  lseq <span class="ot">&lt;-</span> <span class="fu">length</span>(sequence) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  ml <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>  (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lseq) {</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    ml[[i]] <span class="ot">&lt;-</span> x[(sequence[i])<span class="sc">:</span>(sequence[i <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(srcX, srcY, dstX, dstY)]</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  cl <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(ncl)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(cl,)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  roads <span class="ot">&lt;-</span> foreach<span class="sc">::</span><span class="st">`</span><span class="at">%dopar%</span><span class="st">`</span>(</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    foreach<span class="sc">::</span><span class="fu">foreach</span>(</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">ml =</span> ml,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">"osrm"</span>, <span class="st">"sf"</span>),</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">.combine =</span> rbind,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">.inorder =</span> <span class="cn">FALSE</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>      l <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">nrow</span>(ml))</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>( i <span class="cf">in</span> <span class="fu">seq_along</span>(l)){</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>        l[[i]] <span class="ot">&lt;-</span> <span class="fu">osrmRoute</span>(<span class="at">src =</span> ml[i, <span class="fu">c</span>(srcX, srcY)], </span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>                            <span class="at">dst =</span> ml[i, <span class="fu">c</span>(dstX, dstY)], </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>                            <span class="at">osrm.server =</span> <span class="st">"http://0.0.0.0:5000/"</span>,</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>                            <span class="at">osrm.profile =</span> <span class="st">"car"</span>,</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>                            <span class="at">overview =</span> <span class="st">"full"</span>)</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>      l <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, l)</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>      l</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>  parallel<span class="sc">::</span><span class="fu">stopCluster</span>(cl)</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>  roads</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Nous pouvons maintenant extraire les routes avec la fonction <code>get_routes()</code>.</p>
<div class="cell" data-hash="index_cache/html/nadagetroadsnope_2f6e2fc4d8b3de0c84a2265100f4a34e">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">get_routes</span>(<span class="at">x =</span> covdep, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">srcX =</span> <span class="st">"journey_start_lon"</span>, </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">srcY =</span> <span class="st">"journey_start_lat"</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dstX =</span> <span class="st">"journey_end_lon"</span>, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dstY =</span> <span class="st">"journey_end_lat"</span>, </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ncl =</span> <span class="dv">7</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Affichons 3 trajets au hasard. Pour les visualiser nous utilisons le package <code>sf</code> <span class="citation" data-cites="R-sf">(<a href="#ref-R-sf" role="doc-biblioref">Pebesma, 2018</a>)</span>.</p>
<div class="cell" data-hash="index_cache/html/trestrajos_67c35dfee399d37268c893dbde6d2fff">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(roads[<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>,]))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/trestrajos-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Cette opération d’extraction étant assez lourde nous pouvons sauvegarder son résultat pour une utilisation ultérieure.</p>
<div class="cell" data-hash="index_cache/html/nadagetroads_46242fd32a2b452e6201863a727cdbb7">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> roads, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="st">"data/road.gpkg"</span>, </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">layer =</span> <span class="fu">paste0</span>(<span class="st">"road_"</span>,dep), </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-des-trajets-pré-enregistrés" class="level3" data-number="2.3.5">
<h3 data-number="2.3.5" class="anchored" data-anchor-id="import-des-trajets-pré-enregistrés"><span class="header-section-number">2.3.5</span> (Import des trajets pré-enregistrés)</h3>
<div class="cell" data-hash="index_cache/html/importroadspourdefaux_0ca86f49ad086490c39932b7ccfb4dff">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/road.gpkg"</span>, <span class="at">layer =</span> <span class="fu">paste0</span>(<span class="st">"road_"</span>,dep))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comparaison-des-trajets-réels-et-théoriques" class="level3" data-number="2.3.6">
<h3 data-number="2.3.6" class="anchored" data-anchor-id="comparaison-des-trajets-réels-et-théoriques"><span class="header-section-number">2.3.6</span> Comparaison des trajets réels et théoriques</h3>
<p>Nous pouvons maintenant comparer les distances et les durées réelles et théoriques.</p>
<div class="cell" data-hash="index_cache/html/graphroadsosrm_4b89d0d52ceb72d642bc79b01721cef5">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># définition de l'unité de mesure</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">units</span>(roads<span class="sc">$</span>duration) <span class="ot">&lt;-</span> <span class="st">"min"</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">units</span>(roads<span class="sc">$</span>distance) <span class="ot">&lt;-</span> <span class="st">"km"</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># arrondi des durées</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>duree_osrm <span class="ot">&lt;-</span> <span class="fu">round</span>(roads<span class="sc">$</span>duration,<span class="dv">2</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>distance_osrm <span class="ot">&lt;-</span> roads<span class="sc">$</span>distance</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(duree, duree_osrm, <span class="at">asp =</span> <span class="dv">1</span>, </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">5</span>, <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">bg =</span> <span class="st">"darkred"</span>, </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Rapport entre durées réelles et théoriques"</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/graphroadsosrm-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(distance, distance_osrm, <span class="at">asp =</span> <span class="dv">1</span>, </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">5</span>, <span class="at">col =</span> <span class="st">"white"</span>, </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">bg =</span> <span class="st">"darkblue"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Rapport entre distances réelles et théoriques"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/graphroadsosrm-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cartographie-1" class="level3" data-number="2.3.7">
<h3 data-number="2.3.7" class="anchored" data-anchor-id="cartographie-1"><span class="header-section-number">2.3.7</span> Cartographie 1</h3>
<p>Sur une première carte nous montrerons les tronçons de routes empruntés par les usagers du covoiturage dans la zone où a lieu le plus grand nombre de départs dans le département. L’epaisseur de chaque tronçons doit être proportionelle aux nombre de voitures l’empruntant.</p>
<section id="trouver-la-zone-ou-a-lieu-le-plus-grand-nombre-de-départs" class="level4" data-number="2.3.7.1">
<h4 data-number="2.3.7.1" class="anchored" data-anchor-id="trouver-la-zone-ou-a-lieu-le-plus-grand-nombre-de-départs"><span class="header-section-number">2.3.7.1</span> Trouver la zone ou a lieu le plus grand nombre de départs</h4>
<p>Création d’une couche de points des lieux de départs :</p>
<div class="cell" data-hash="index_cache/html/tlse_4fb55dea709761a209eb562b6f00799a">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>covdep_start <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(covdep, </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">coords  =</span> <span class="fu">c</span>(<span class="st">'journey_start_lon'</span>, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">'journey_start_lat'</span>), </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">crs =</span> <span class="st">"EPSG:4326"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># reprojection en webmercator</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>covdep_start <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(covdep_start, <span class="st">"EPSG:3857"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>EPCI ou AOM (<em>towngroup</em>) où ont lieux le plus de départs :</p>
<div class="cell" data-hash="index_cache/html/tlse1_1fe7b87655ced4edf62b3ba6d760368f">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggrégation des départ par EPCI ou AOM </span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># et sélection de l'EPCI ou AOM ayant le plus de départs</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>city <span class="ot">&lt;-</span> <span class="fu">tapply</span>(<span class="at">X =</span> covdep<span class="sc">$</span>trip_id, </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">INDEX =</span> covdep<span class="sc">$</span>journey_start_towngroup, </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">FUN =</span> length) <span class="sc">|&gt;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>)<span class="sc">|&gt;</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()<span class="sc">|&gt;</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>city</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Toulouse Métropole"</code></pre>
</div>
</div>
<p>Création d’une zone de 30 km autour du centroide des départs de la zone :</p>
<div class="cell" data-hash="index_cache/html/tlse2_903c43e78c7126f8af0d0b4442941384">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>zone <span class="ot">&lt;-</span> covdep_start <span class="sc">|&gt;</span>                          <span class="co"># à partir des points de départs</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(journey_start_towngroup <span class="sc">%in%</span> city) <span class="sc">|&gt;</span>   <span class="co"># sélection des points de l'EPCI</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span>                               <span class="co"># extraction de leurs géométrie</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">|&gt;</span>                                  <span class="co"># transformation en multipoint</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>() <span class="sc">|&gt;</span>                               <span class="co"># extraction du centroide    </span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">30000</span>) <span class="sc">|&gt;</span>                            <span class="co"># buffer autour du centroid</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>()                                        <span class="co"># transformation en objet sf</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Affichage de la zone :</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_3d5664059fe104ec85dd2fd3c6cbcca7">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(zone)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="télécharger-des-tuiles-raster-pour-le-fond-de-carte" class="level4" data-number="2.3.7.2">
<h4 data-number="2.3.7.2" class="anchored" data-anchor-id="télécharger-des-tuiles-raster-pour-le-fond-de-carte"><span class="header-section-number">2.3.7.2</span> Télécharger des tuiles raster pour le fond de carte</h4>
<p>Téléchargement de tuiles raster (Terrain Background de chez Stamen) sur la zone. Nous utilisons le package <code>maptiles</code> <span class="citation" data-cites="R-maptiles">(<a href="#ref-R-maptiles" role="doc-biblioref">Giraud, 2022b</a>)</span> pour cela :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maptiles)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>osm <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(zone, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">provider =</span> <span class="st">"Stamen.TerrainBackground"</span>, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">zoom =</span> <span class="dv">11</span>, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">cachedir =</span> <span class="st">"tiles"</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tiles</span>(osm)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/osmT-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Nous pouvons ensuite découper les tuiles en fonction de la zone définie précédement. Pour cela nous utilisons le package <code>terra</code> <span class="citation" data-cites="R-terra">(<a href="#ref-R-terra" role="doc-biblioref">Hijmans, 2022</a>)</span> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>terra 1.6.47</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>osm_r <span class="ot">&lt;-</span> osm <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mask</span>(zone) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(zone)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons ensuite visualiser les tuiles et la zone grace au package <code>mapsf</code> <span class="citation" data-cites="R-mapsf">(<a href="#ref-R-mapsf" role="doc-biblioref">Giraud, 2022a</a>)</span>.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_e02a72c5efab311a3490560727d0a2aa">

</div>
<div class="cell" data-hash="index_cache/html/osmT3_c85b7b4bf7aeca20a97b328e3e65c883">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># définition d'un thème</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>theme <span class="ot">&lt;-</span> <span class="fu">mf_theme</span>(<span class="st">"green"</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>), </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">line =</span> <span class="dv">2</span>, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cex =</span> <span class="fl">1.8</span>, </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">inner =</span> <span class="cn">FALSE</span>, </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">pos =</span> <span class="st">"left"</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># initialisation de la carte sur l'objet "zone"</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_init</span>(zone)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># affichage des tuiles</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_raster</span>(osm_r, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># affichage de la zone</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(zone, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="dv">15</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co"># titre</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(city)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/osmT3-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section>
<section id="agrégation-des-tronçons" class="level4" data-number="2.3.7.3">
<h4 data-number="2.3.7.3" class="anchored" data-anchor-id="agrégation-des-tronçons"><span class="header-section-number">2.3.7.3</span> Agrégation des tronçons</h4>
<p>Pour l’instant chaque trajet est individualisé. Si plusieurs trajets empruntent le même tronçon ils se superposent. Ces superpositions sont visibles dans la carte suivante utilisant la transparence.</p>
<div class="cell" data-hash="index_cache/html/prep_b734ee0e759cd10b98c4c78408e3c9e7">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Préparation des routes</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># reprojection en webmercator</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(roads, <span class="st">"EPSG:3857"</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># découpage des route à la limite de la zone</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(roads, <span class="fu">st_geometry</span>(zone))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only linestrings</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">st_collection_extract</span>(roads, <span class="st">"LINESTRING"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="index_cache/html/alpha_fe25f83739d82d30eae03d5e932ce4db">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_init</span>(zone, <span class="at">theme =</span> theme)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_raster</span>(osm_r, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># affichage des routes avec de la transparence  </span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(roads, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"#94000005"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(zone, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="dv">15</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(city)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/alpha-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Nous devons maintenant agréger les tronçons de route se superposant et compter le nombre de superpositions par tronçons. Pour cela nous utilisons le package <code>stplanr</code> <span class="citation" data-cites="R-stplanr">(<a href="#ref-R-stplanr" role="doc-biblioref">Robin Lovelace et Richard Ellison, 2018</a>)</span>. Cette opération est assez lourde, nous enregistrons son résultat pour une utilisation ultérieure :</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_2430d16ffb8e75793d7a2984801df8ed">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrégation des tronçons</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stplanr)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># variable de poids (1 pour chaque trajets)</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>roads<span class="sc">$</span>n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># agrégation des trajets par tronçons</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>roads_n <span class="ot">&lt;-</span> <span class="fu">overline</span>(<span class="at">sl =</span> roads, <span class="at">attrib =</span> <span class="st">"n"</span>, <span class="at">ncores =</span> <span class="dv">7</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Sauvegarder le résultat</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> roads_n, </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="st">"data/road.gpkg"</span>, </span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">layer =</span> <span class="fu">paste0</span>(<span class="st">"road_"</span>,dep,<span class="st">"_ag"</span>), </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(Import des tronçons agrégés)</p>
<div class="cell" data-hash="index_cache/html/importroads_f8735db9f721b87afa6d40a775cc3b45">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>roads_n <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/road.gpkg"</span>, </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">layer =</span> <span class="fu">paste0</span>(<span class="st">"road_"</span>,dep, <span class="st">"_ag"</span>), </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="création-de-la-carte" class="level4" data-number="2.3.7.4">
<h4 data-number="2.3.7.4" class="anchored" data-anchor-id="création-de-la-carte"><span class="header-section-number">2.3.7.4</span> Création de la carte</h4>
<div class="cell" data-hash="index_cache/html/osmap_18bb88a2f378ce664e3f464c123d9cb1">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Valeur max</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>maxv <span class="ot">&lt;-</span> <span class="fu">max</span>(roads_n<span class="sc">$</span>n)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Credits de la carte</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>credits <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"T. Giraud, 2023</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">get_credit</span>(<span class="st">"Stamen.TerrainBackground"</span>), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Registre de Preuve de Covoiturage (DGITM) - "</span>, </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Au départ du département, pour moins de 100 km et "</span>,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"moins d'1H30, "</span>,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"de septembre à novembre 2022"</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Début de l'export, définition de ses dimentions</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_export</span>(zone, <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"map"</span>, dep, <span class="st">".png"</span>), </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">width =</span> <span class="dv">700</span>, <span class="at">expandBB =</span> <span class="fu">c</span>(.<span class="dv">05</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.2</span>), </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">theme =</span> theme)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage des tuiles</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_raster</span>(osm_r, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage des routes epaisseurs proportionnelles</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="co"># aux nombre de superpositions</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> roads_n, <span class="at">var =</span> <span class="st">'n'</span>, <span class="at">type =</span> <span class="st">'prop'</span>, </span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">val_max =</span> maxv, <span class="at">col =</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_pos =</span> <span class="st">"topright"</span>, </span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="st">"Nombre de</span><span class="sc">\n</span><span class="st">covoiturages</span><span class="sc">\n</span><span class="st">par tronçon"</span>, </span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_frame =</span> <span class="cn">TRUE</span>, </span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="co"># titre</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(city)</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="co"># credits</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(credits)</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co"># zone</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> zone, <span class="at">col  =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="dv">15</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a><span class="co"># echelle</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_scale</span>(<span class="dv">5</span>)</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Fin de l'export</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="map31.png" class="img-fluid" width="700"></p>
</section>
</section>
<section id="cartographie-2" class="level3" data-number="2.3.8">
<h3 data-number="2.3.8" class="anchored" data-anchor-id="cartographie-2"><span class="header-section-number">2.3.8</span> Cartographie 2</h3>
<p>Sur cette carte nous allons représenter le nombre de départs en agrégeant les points de départs dans un maillage régulier.</p>
<section id="création-dune-grille-régulière" class="level4" data-number="2.3.8.1">
<h4 data-number="2.3.8.1" class="anchored" data-anchor-id="création-dune-grille-régulière"><span class="header-section-number">2.3.8.1</span> Création d’une grille régulière</h4>
<div class="cell" data-hash="index_cache/html/gridcreate_5dca279fb4286819b5f76abf2f73eead">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># superficie d'une cellule (1km2)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>size <span class="ot">&lt;-</span> <span class="fl">1e6</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># transformation de la surface en "rayon" d'un hexagone</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>cellsize <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">sqrt</span>(size<span class="sc">/</span>((<span class="dv">3</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">3</span>)<span class="sc">/</span><span class="dv">2</span>))) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">3</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># création d'une grille d'hexagones</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(<span class="at">x =</span> zone, </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cellsize =</span> cellsize, </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">square =</span> <span class="cn">FALSE</span>) </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># transformation sfc vers sf + ajout id</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(grid), <span class="at">geometry =</span> grid)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># affichage du resultat</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(grid)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(zone, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">border =</span> <span class="st">"red"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/gridcreate-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section>
<section id="découpage-de-la-grille-par-la-zone" class="level4" data-number="2.3.8.2">
<h4 data-number="2.3.8.2" class="anchored" data-anchor-id="découpage-de-la-grille-par-la-zone"><span class="header-section-number">2.3.8.2</span> Découpage de la grille par la zone</h4>
<div class="cell" data-hash="index_cache/html/gridcut_653b5f516665ac83cd287b3e61dd10fe">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(grid, zone)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># affichage du resultat</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(grid)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(zone, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">border =</span> <span class="st">"red"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/gridcut-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section>
<section id="compter-les-points-dans-la-grille" class="level4" data-number="2.3.8.3">
<h4 data-number="2.3.8.3" class="anchored" data-anchor-id="compter-les-points-dans-la-grille"><span class="header-section-number">2.3.8.3</span> Compter les points dans la grille</h4>
<div class="cell" data-hash="index_cache/html/cptpt_dc54db6bcf017ff9a7c8c6caaaeb8ccc">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># liste des intersections</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>inter_g_pt <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(grid, covdep_start)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Chaque element de la liste contient l'index des points se trouvant dans le </span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># polygone correspondant</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>inter_g_pt[<span class="dv">120</span><span class="sc">:</span><span class="dv">125</span>]</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 26480 27030 27359

[[2]]
integer(0)

[[3]]
 [1]  2202  3553  4111  4541  5892 12875 15891 16369 17221 18148 26264 26498
[13] 28588

[[4]]
 [1]   743  1302  1762  4104  5076  5409  5460  5890  6447  7736 13445 16925
[13] 20420 23559

[[5]]
[1] 2878

[[6]]
integer(0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># parcourir la liste et compter le nombre d'intersections</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>n_pt <span class="ot">&lt;-</span> <span class="fu">sapply</span>(inter_g_pt, length)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="création-de-la-carte-1" class="level4" data-number="2.3.8.4">
<h4 data-number="2.3.8.4" class="anchored" data-anchor-id="création-de-la-carte-1"><span class="header-section-number">2.3.8.4</span> Création de la carte</h4>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_23d671f849f6b41ea742049fba6f9586">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_export</span>(zone, <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"map"</span>, dep, <span class="st">"hexa_point.png"</span>), </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">width =</span> <span class="dv">700</span>, <span class="at">expandBB =</span> <span class="fu">c</span>(.<span class="dv">05</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.2</span>), </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">theme =</span> theme)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_raster</span>(osm_r, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(grid, </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">var =</span> <span class="st">"n_pt"</span>, <span class="at">type =</span> <span class="st">'prop'</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_pos =</span> <span class="st">"topright"</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="st">"Nombre de départs"</span>,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">inches =</span> .<span class="dv">175</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2172 '0' values are not plotted on the map.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(city)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(credits)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> zone, <span class="at">col  =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="dv">15</span>, <span class="at">add =</span> T)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_scale</span>(<span class="dv">5</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="map31hexa_point.png" class="img-fluid" width="700"></p>
</section>
</section>
<section id="cartographie-3" class="level3" data-number="2.3.9">
<h3 data-number="2.3.9" class="anchored" data-anchor-id="cartographie-3"><span class="header-section-number">2.3.9</span> Cartographie 3</h3>
<p>Représentons maintenant la densité de points par cellulle de notre maillage régulier. Pour cela nous devons créer une variable de densité de points par km2 et la discrétiser.</p>
<section id="discrétisation" class="level4" data-number="2.3.9.1">
<h4 data-number="2.3.9.1" class="anchored" data-anchor-id="discrétisation"><span class="header-section-number">2.3.9.1</span> Discrétisation</h4>
<div class="cell" data-hash="index_cache/html/discr1_bbf7bbbf1ea48e23a48b80cb7dabaf44">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># densité de points</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>dens_pt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(grid<span class="sc">$</span>n_pt <span class="sc">/</span> <span class="fu">set_units</span>(<span class="fu">st_area</span>(grid), <span class="st">"km2"</span>))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># discretisation</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(grid<span class="sc">$</span>dens_pt)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(v)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/discr1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ne gardons que les cellule &gt;0</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> v[v<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>htitle <span class="ot">&lt;-</span> <span class="st">"Distribution de la densité de départs"</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>hlab <span class="ot">&lt;-</span> <span class="st">"Départs par km2"</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">5.1</span>,<span class="fl">2.1</span>,<span class="fl">2.1</span>,<span class="fl">2.1</span>), <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> v, </span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">50</span>,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> htitle, </span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> hlab,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="cn">FALSE</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(v, <span class="at">horizontal =</span> T)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="fu">stripchart</span>(</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> v,</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"jitter"</span>, </span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">21</span>,</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"red"</span>, </span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex =</span> .<span class="dv">9</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/discr1-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>La distribution de la variable est très dissymétrique à gauche. Utilisons une discrétisation basée sur une progression géométrique.</p>
<div class="cell" data-hash="index_cache/html/discr2_e6f6e111d3490f3d248284feb773be9a">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>bks <span class="ot">&lt;-</span> <span class="fu">mf_get_breaks</span>(</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> v, </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbreaks =</span> <span class="dv">8</span>, </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="st">"geom"</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">mf_get_pal</span>(</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">8</span>, </span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"SunsetDark"</span>,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">rev =</span> <span class="cn">TRUE</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">5.1</span>,<span class="fl">0.1</span>,<span class="fl">2.1</span>,<span class="fl">0.1</span>))</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">hist</span>(</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> v, </span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> bks, </span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> cols, </span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> hlab, </span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="cn">FALSE</span>, </span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">axes =</span> <span class="cn">FALSE</span>, </span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">""</span>,</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> htitle, </span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="st">"grey80"</span>, </span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="dv">3</span>, </span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.02</span>, <span class="fl">0.175</span>), </span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(v))</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a><span class="fu">stripchart</span>(</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> v, </span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">21</span>,</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"grey20"</span>, </span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">at =</span> <span class="sc">-</span><span class="fl">0.015</span>, </span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">jitter =</span> <span class="fl">0.007</span>, </span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">add =</span> <span class="cn">TRUE</span>,</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"jitter"</span>, </span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex =</span> .<span class="dv">7</span>,</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">""</span></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side =</span> <span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">round</span>(<span class="fu">max</span>(v), <span class="dv">0</span>),<span class="dv">200</span>), <span class="at">lwd =</span> .<span class="dv">5</span>, <span class="at">col =</span> <span class="st">"grey50"</span>)</span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> bks, <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(bks)), <span class="at">pch =</span> <span class="st">"|"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/discr2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="création-de-la-carte-2" class="level4" data-number="2.3.9.2">
<h4 data-number="2.3.9.2" class="anchored" data-anchor-id="création-de-la-carte-2"><span class="header-section-number">2.3.9.2</span> Création de la carte</h4>
<div class="cell" data-hash="index_cache/html/cartor_44c65e262b9bfe53f3691bbb659e4abc">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_export</span>(zone, <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"map"</span>, dep, <span class="st">"hexa.png"</span>), </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">width =</span> <span class="dv">700</span>, <span class="at">expandBB =</span> <span class="fu">c</span>(.<span class="dv">05</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.2</span>), </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">theme =</span> theme)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_raster</span>(osm_r, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(grid[grid<span class="sc">$</span>dens_pt<span class="sc">&gt;</span><span class="dv">0</span>,], <span class="at">var =</span> <span class="st">"dens_pt"</span>, <span class="at">type =</span> <span class="st">'choro'</span>, </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">breaks =</span> bks, <span class="at">pal=</span> cols, </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="cn">NA</span>, </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="st">"Densité de départs</span><span class="sc">\n</span><span class="st">par km2"</span>, </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_pos =</span> <span class="st">"topright"</span>,</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_val_rnd =</span> <span class="dv">0</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(city)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(credits)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> zone, <span class="at">col  =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="dv">15</span>, <span class="at">add =</span> T)</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_scale</span>(<span class="dv">5</span>)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="map31hexa.png" class="img-fluid" width="700"></p>
</section>
</section>
<section id="cartographie-4" class="level3" data-number="2.3.10">
<h3 data-number="2.3.10" class="anchored" data-anchor-id="cartographie-4"><span class="header-section-number">2.3.10</span> Cartographie 4</h3>
<p>Sur une deuxième carte nous allons représenter la densité des points de départs en utilisant la méthode KDE.</p>
<section id="calcul-du-kde" class="level4" data-number="2.3.10.1">
<h4 data-number="2.3.10.1" class="anchored" data-anchor-id="calcul-du-kde"><span class="header-section-number">2.3.10.1</span> Calcul du KDE</h4>
<p>Pour cela nous utilisons le package <code>spatstat</code> <span class="citation" data-cites="R-spatstat">(<a href="#ref-R-spatstat" role="doc-biblioref">Baddeley et Turner, 2005</a>)</span> :</p>
<div class="cell" data-hash="index_cache/html/liss_06f370e63022aded23dc9827efb0ce74">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"spatstat"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.data</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.geom</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.geom 3.0-3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'spatstat.geom'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:terra':

    area, delaunay, rescale, rotate, shift, where.max, where.min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.random</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.random 3.0-1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.explore</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: nlme</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.explore 3.0-5</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.model</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: rpart</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.model 3.0-2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.linnet</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.linnet 3.0-3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
spatstat 3.0-2 
For an introduction to spatstat, type 'beginner' </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transformation des points sf en points spatstat</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">as.ppp</span>(<span class="fu">st_coordinates</span>(covdep_start), <span class="at">W =</span> <span class="fu">as.owin</span>(zone))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 1751 points were rejected as lying outside the specified window</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calcul du KDE</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>ds <span class="ot">&lt;-</span> <span class="fu">density.ppp</span>(p, <span class="at">sigma =</span> <span class="dv">1000</span>, <span class="at">eps =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>), <span class="at">positive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>rasdens <span class="ot">&lt;-</span> <span class="fu">rast</span>(ds) <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(rasdens) <span class="ot">&lt;-</span> <span class="st">'EPSG:3857'</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rasdens)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/liss-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cartographie" class="level4" data-number="2.3.10.2">
<h4 data-number="2.3.10.2" class="anchored" data-anchor-id="cartographie"><span class="header-section-number">2.3.10.2</span> Cartographie</h4>
<p>Nous utlisons le package <code>tanaka</code> <span class="citation" data-cites="R-tanaka">(<a href="#ref-R-tanaka" role="doc-biblioref">Giraud, 2022d</a>)</span> pour représenter le KDE avec un effet pseudo 3D :</p>
<div class="cell" data-hash="index_cache/html/liss2_512fdda5c86e2f739dcf24fec3e3f7f4">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calcul des bornes des classes</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">values</span>(rasdens)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>bks <span class="ot">&lt;-</span> <span class="fu">mf_get_breaks</span>(v[v<span class="sc">&gt;</span><span class="dv">5</span>], <span class="at">nbreaks =</span> <span class="dv">8</span>, <span class="at">breaks =</span> <span class="st">"geom"</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>bks <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(<span class="dv">0</span>,bks))</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="co"># création d'une palette de couleurs</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">hcl.colors</span>(<span class="at">n =</span> <span class="fu">length</span>(bks)<span class="sc">-</span><span class="dv">1</span>, <span class="st">"Inferno"</span>, <span class="at">rev=</span>F)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co"># crédits</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>credits <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"T. Giraud, 2023</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Registre de Preuve de Covoiturage (DGITM)</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Au départ du département, pour moins de 100 km et "</span>,</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"moins d'1H30, "</span>,</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"de septembre à novembre 2022"</span>)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tanaka)</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_export</span>(zone, <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"map"</span>, dep, <span class="st">"dens.png"</span>), </span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">width =</span> <span class="dv">700</span>, <span class="at">expandBB =</span> <span class="fu">c</span>(.<span class="dv">05</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.2</span>), </span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">theme =</span> theme)</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a><span class="fu">tanaka</span>(rasdens, <span class="at">breaks =</span> bks, <span class="at">col =</span> cols, </span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend.pos =</span> <span class="st">"n"</span>, <span class="at">mask =</span> zone, </span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_legend</span>(<span class="at">type =</span> <span class="st">"choro"</span>, <span class="at">pos =</span> <span class="st">"topright"</span>,</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">val =</span> bks,<span class="at">pal =</span> cols, </span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Densité de départs</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"KDE, sigma=1km</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"(départs par km2)"</span>),</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">val_rnd =</span> <span class="dv">0</span>)</span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(roads_n, <span class="st">'n'</span>, <span class="st">'prop'</span>, <span class="at">col =</span> <span class="st">"#ffffff50"</span>,</span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="st">"Nombre de</span><span class="sc">\n</span><span class="st">covoiturages</span><span class="sc">\n</span><span class="st">par tronçon"</span>, </span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">val_max =</span> maxv, <span class="at">leg_pos =</span> <span class="st">"right"</span>)</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(city)</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(credits)</span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> zone, <span class="at">col  =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="dv">15</span>, <span class="at">add =</span> T)</span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_scale</span>(<span class="dv">5</span>)</span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="map31dens.png" class="img-fluid" width="700"></p>
</section>
</section>
</section>
<section id="autres-villes" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="autres-villes"><span class="header-section-number">2.4</span> Autres villes</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Nantes</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Montpellier</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><img src="map44.png" class="img-fluid" width="700"> <img src="map44hexa_point.png" class="img-fluid" width="700"> <img src="map44hexa.png" class="img-fluid" width="700"> <img src="map44dens.png" class="img-fluid" width="700"></p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p><img src="map34.png" class="img-fluid" width="700"> <img src="map34hexa_point.png" class="img-fluid" width="700"> <img src="map34hexa.png" class="img-fluid" width="700"> <img src="map34dens.png" class="img-fluid" width="700"></p>
</div>
</div>
</div>
</section>
<section id="pour-la-reproductibilité" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="pour-la-reproductibilité"><span class="header-section-number">2.5</span> Pour la reproductibilité</h2>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_2f53f8294c1cddd0b7164613f2c83c11">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.2 (2022-10-31)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Debian GNU/Linux 11 (bullseye)

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0

locale:
 [1] LC_CTYPE=fr_FR.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=fr_FR.UTF-8        LC_COLLATE=fr_FR.UTF-8    
 [5] LC_MONETARY=fr_FR.UTF-8    LC_MESSAGES=fr_FR.UTF-8   
 [7] LC_PAPER=fr_FR.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=fr_FR.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] tanaka_0.3.0           spatstat_3.0-2         spatstat.linnet_3.0-3 
 [4] spatstat.model_3.0-2   rpart_4.1.19           spatstat.explore_3.0-5
 [7] nlme_3.1-160           spatstat.random_3.0-1  spatstat.geom_3.0-3   
[10] spatstat.data_3.0-0    mapsf_0.6.1            terra_1.6-47          
[13] maptiles_0.4.0         sf_1.0-9               units_0.8-1           

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.9            lattice_0.20-45       deldir_1.0-6         
 [4] png_0.1-8             class_7.3-20          assertthat_0.2.1     
 [7] digest_0.6.31         utf8_1.2.2            R6_2.5.1             
[10] evaluate_0.19         e1071_1.7-12          tensor_1.5           
[13] highr_0.10            pillar_1.8.1          mapiso_0.2.0         
[16] rlang_1.0.6           rstudioapi_0.14       Matrix_1.5-3         
[19] goftest_1.2-3         rmarkdown_2.19        splines_4.2.2        
[22] stringr_1.5.0         htmlwidgets_1.6.0     polyclip_1.10-4      
[25] proxy_0.4-27          compiler_4.2.2        xfun_0.36            
[28] pkgconfig_2.0.3       mgcv_1.8-41           htmltools_0.5.4      
[31] tidyselect_1.2.0      tibble_3.1.8          codetools_0.2-18     
[34] fansi_1.0.3           dplyr_1.0.10          grid_4.2.2           
[37] jsonlite_1.8.4        lifecycle_1.0.3       DBI_1.1.3            
[40] magrittr_2.0.3        KernSmooth_2.23-20    cli_3.5.0            
[43] stringi_1.7.8         spatstat.utils_3.0-1  generics_0.1.3       
[46] vctrs_0.5.1           tools_4.2.2           glue_1.6.2           
[49] purrr_1.0.0           abind_1.4-5           fastmap_1.1.0        
[52] slippymath_0.3.1      yaml_2.3.6            spatstat.sparse_3.0-0
[55] isoband_0.2.7         classInt_0.4-8        knitr_1.41           </code></pre>
</div>
</div>

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">Les références</h2><div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="doc-bibliography">
<div id="ref-R-spatstat" class="csl-entry" role="doc-biblioentry">
Baddeley, A. et Turner, R. (2005). <span>spatstat</span>: An <span>R</span> Package for Analyzing Spatial Point Patterns. <em>Journal of Statistical Software</em>, <em>12</em>(6), 1‑42. <a href="https://doi.org/10.18637/jss.v012.i06">https://doi.org/10.18637/jss.v012.i06</a>
</div>
<div id="ref-R-mapsf" class="csl-entry" role="doc-biblioentry">
Giraud, T. (2022a). <em>mapsf: Thematic Cartography</em>. <a href="https://CRAN.R-project.org/package=mapsf">https://CRAN.R-project.org/package=mapsf</a>
</div>
<div id="ref-R-maptiles" class="csl-entry" role="doc-biblioentry">
Giraud, T. (2022b). <em>maptiles: Download and Display Map Tiles</em>. <a href="https://CRAN.R-project.org/package=maptiles">https://CRAN.R-project.org/package=maptiles</a>
</div>
<div id="ref-R-osrm" class="csl-entry" role="doc-biblioentry">
Giraud, T. (2022c). <span>osrm: Interface Between R and the OpenStreetMap-Based Routing Service OSRM</span>. <em>Journal of Open Source Software</em>, <em>7</em>(78), 4574. <a href="https://doi.org/10.21105/joss.04574">https://doi.org/10.21105/joss.04574</a>
</div>
<div id="ref-R-tanaka" class="csl-entry" role="doc-biblioentry">
Giraud, T. (2022d). <em>tanaka: Design Shaded Contour Lines (or Tanaka) Maps</em>. <a href="https://CRAN.R-project.org/package=tanaka">https://CRAN.R-project.org/package=tanaka</a>
</div>
<div id="ref-R-terra" class="csl-entry" role="doc-biblioentry">
Hijmans, R. J. (2022). <em>terra: Spatial Data Analysis</em>. <a href="https://CRAN.R-project.org/package=terra">https://CRAN.R-project.org/package=terra</a>
</div>
<div id="ref-luxen-vetter-2011" class="csl-entry" role="doc-biblioentry">
Luxen, D. et Vetter, C. (2011). <em>Real-time routing with OpenStreetMap data</em>. New York, NY, USA (p. 513‑516). <a href="https://doi.org/10.1145/2093973.2094062">https://doi.org/10.1145/2093973.2094062</a>
</div>
<div id="ref-R-sf" class="csl-entry" role="doc-biblioentry">
Pebesma, E. (2018). <span>Simple Features for R: Standardized Support for Spatial Vector Data</span>. <em><span>The R Journal</span></em>, <em>10</em>(1), 439‑446. <a href="https://doi.org/10.32614/RJ-2018-009">https://doi.org/10.32614/RJ-2018-009</a>
</div>
<div id="ref-R-units" class="csl-entry" role="doc-biblioentry">
Pebesma, E., Mailund, T. et Hiebert, J. (2016). Measurement Units in <span>R</span>. <em>R Journal</em>, <em>8</em>(2), 486‑494. <a href="https://doi.org/10.32614/RJ-2016-061">https://doi.org/10.32614/RJ-2016-061</a>
</div>
<div id="ref-R-stplanr" class="csl-entry" role="doc-biblioentry">
Robin Lovelace et Richard Ellison. (2018). <span>stplanr: A Package for Transport Planning</span>. <em><span>The R Journal</span></em>, <em>10</em>(2). <a href="https://doi.org/10.32614/RJ-2018-053">https://doi.org/10.32614/RJ-2018-053</a>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>